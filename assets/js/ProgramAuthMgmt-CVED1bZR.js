import{A as e,b as a,n as t,v as r,w as i,e as d,d as l,t as n,h as o,p as u,q as s,i as g,u as m,r as c,B as h,C as p,s as v,D as C,G as f,U as w,O as I,T as P,k as b}from"./index-Brc5gCI7.js";import{E as y}from"./element-split-panes-D8f3p_XR.js";import{E as A}from"./element-select-BCEadPkV.js";import{E as G}from"./element-text-D-EPVcTe.js";import{g as R,R as T}from"./real-grid-D0HQpUC9.js";import{g as V}from"./gridUtils-CpYDX3xm.js";import{C as k}from"./container-view-8Dpp6B-p.js";import{S as D}from"./search-container-CrqIufVW.js";import"./popup-container-CgYeCOO4.js";import"./footer-view-DbGzI4eV.js";const{t:S}=e.global,j=(e,a)=>({programId:e,gridId:a,gridTitle:S(`${e}.${a}.title`),setting:{checkBarVisible:!1,isReadOnly:!0},columns:[R.hidden({name:"programId"}),R.hidden({name:"btnGrpId"}),R.hidden({name:"buttonId"}),R.messagesId({headerText:S(`${e}.${a}.buttonName`),nameField:"buttonNameLocale",refField:"buttonName",isVisible:!1})]}),{t:$}=e.global,_=(e,a)=>({programId:e,gridId:a,gridTitle:$(`${e}.${a}.title`),setting:{isReadOnly:!0,checkBarVisible:!1,useFocusClass:!0},columns:[R.hidden({name:"programId"}),R.text({headerText:$(`${e}.${a}.programNm`),name:"programNm",width:"150",editable:!1})]}),N="gridProgramRef",x="gridAuthRef",E={class:"flex_content"};const M=a(Object.assign({menuId:"programAuthMgmt",programId:"ProgramAuthMgmt"},{__name:"ProgramAuthMgmt",setup(e,{expose:a}){a();const t=s(),r=t?.type.menuId,i=t?.type.programId,{t:d}=o(),l=u("emitter"),n=`mittMenuCheck_${r}`;l.on(n,async e=>{await V.isChangeRowData([{dataProvider:B.value},{dataProvider:q.value}])&&l.emit(`mitt${e.target}MenuClickEvent`,e.data)});const b=m.cloneDeep(_(i,N));let S=m.cloneDeep(j(i,x));const $=m.cloneDeep(j(i,x)),E=c({isReady:!1,comCodes:{},search:{},gridProgramTitle:b.gridTitle,gridProgramView:null,dataProgramProvider:null,selectedRowInfo:{},btnGrpCd:"",isGridAuthReady:!0,gridAuthTitle:S.gridTitle,gridAuthView:null,dataAuthProvider:null}),{isReady:M,comCodes:U,search:O,gridProgramTitle:H,gridProgramView:F,dataProgramProvider:B,selectedRowInfo:z,btnGrpCd:J,isGridAuthReady:K,gridAuthTitle:L,gridAuthView:Y,dataAuthProvider:q}=g(E);h(async()=>{M.value=!1,await p({programId:i}),ae(),await te(),M.value=!0}),v(()=>{l.off(n),m.clearAuth(i)}),C(async()=>{await p({programId:i})}),f(async()=>{m.clearAuth(i)});const W=()=>{P({menuId:"ProgramMgmt",params:O.value}).then(e=>{V.setData({gridView:F.value,dataProvider:B.value,data:e.data}),V.setData({gridView:Y.value,dataProvider:q.value,data:[]}),z.value={}})},Q=async e=>{J.value="",V.setData({gridView:Y.value,dataProvider:q.value,data:[]}),K.value=!1,S=m.cloneDeep($),await I(),K.value=!0,P({menuId:"ProgramMgmt",pathUrl:"btnGrpUrl",params:{programId:e.programId}}).then(e=>{U.value.btnGrpCd=e.data.map(e=>({label:e.btnGrpId,value:e.btnGrpId}))})},X=async e=>{await P({menuId:i,pathUrl:"columnsUrl",params:{programId:z.value.programId,btnGrpId:e}}).then(async e=>{if(K.value=!1,e.data.length>0){const a=m.flattenDeep(m.cloneDeep($.columns)),t=a.map(e=>e.name),r=e.data.map(e=>`authGroup_${e.authCd}`);t.push({name:"authGroupInfo",direction:"horizontal",header:{text:"버튼별 권한설정"},items:r}),S.layout=t,S.addFields=[{fieldName:"authGroup",dataType:"object",objectKey:e.data[0].authCd}],e.data.forEach(e=>{a.push(R.check({headerText:e.authNm,name:`authGroup_${e.authCd}`,fieldName:"authGroup",objectKey:e.authCd,width:"150"}))}),S.columns=a}await I(),K.value=!0})},Z=async e=>{await P({menuId:i,params:{programId:z.value.programId,btnGrpId:e}}).then(e=>{V.setData({gridView:Y.value,dataProvider:q.value,data:e.data})})},ee=e=>{P({method:"post",menuId:i,data:e}).then(()=>{Z(J.value)})},ae=()=>{O.value={idName:""}},te=async()=>{U.value.useYn=w.useYn},re={instance:t,menuId:r,programId:i,t:d,emitter:l,mittMenuCheck:n,gridProgramId:N,gridProgramConfig:b,gridAuthId:x,get gridAuthConfig(){return S},set gridAuthConfig(e){S=e},gridAuthConfigOrg:$,data:E,isReady:M,comCodes:U,search:O,gridProgramTitle:H,gridProgramView:F,dataProgramProvider:B,selectedRowInfo:z,btnGrpCd:J,isGridAuthReady:K,gridAuthTitle:L,gridAuthView:Y,dataAuthProvider:q,getProgramDataHandler:W,getGroupHandler:Q,getColumnList:X,getAuthDataHandler:Z,saveAuthDataHandler:ee,resetHandler:ae,init:te,searchHandler:async()=>{await V.isChangeRowData([{dataProvider:B.value},{dataProvider:q.value}])&&W()},groupChange:async e=>{await V.isChangeRowData([{dataProvider:q.value}])&&(await X(e.value),await Z(e.value))},gridProgramInit:async(e,a)=>{F.value=e,B.value=a,W()},gridProgramCellClicked:async(e,a)=>{if(await V.isChangeRowData([{dataProvider:q.value}])){const e=V.getJsonRow({dataProvider:B.value,dataRow:a.dataRow});z.value=e,Q(e)}},gridAuthInit:async(e,a)=>{Y.value=e,q.value=a},gridAuthSaveClick:async()=>{if(await V.checkValidation({gridView:Y.value,dataProvider:q.value})){const e=await V.saveData({gridView:Y.value,dataProvider:q.value});e.isConfirmed&&ee(e.data)}},getCurrentInstance:s,inject:u,nextTick:I,onActivated:C,onBeforeMount:h,onDeactivated:f,onUnmounted:v,reactive:c,toRefs:g,get useI18n(){return o},get _comCode(){return w},get utils(){return m},get apiCommon(){return P},get apiPageAuth(){return p},ElementSplitPanes:y,ElementSelect:A,ElementText:G,get gridFields(){return R},get gridUtils(){return V},RealGrid:T,ContainerView:k,SearchContainer:D,get gridAuthSetting(){return j},get gridProgramSetting(){return _}};return Object.defineProperty(re,"__isScriptSetup",{enumerable:!1,value:!0}),re}}),[["render",function(e,a,o,u,s,g){return u.isReady?(b(),t(u.ContainerView,{key:0},{default:i(()=>[d(u.SearchContainer,{onSearch:u.searchHandler,onReset:u.resetHandler},{colgroup:i(()=>a[2]||(a[2]=[l("col",{width:"150"},null,-1),l("col",{width:"600"},null,-1),l("col",{width:"*"},null,-1)])),default:i(()=>[l("tbody",null,[l("tr",null,[l("th",null,n(u.t(`${u.programId}.search.idName.title`)),1),l("td",null,[d(u.ElementText,{modelValue:u.search.idName,"onUpdate:modelValue":a[0]||(a[0]=e=>u.search.idName=e),placeholder:u.t(`${u.programId}.search.idName.title.placeholder`)},null,8,["modelValue","placeholder"])]),a[3]||(a[3]=l("td",null,null,-1))])])]),_:1}),d(u.ElementSplitPanes,{leftSize:20},{leftSlot:i(()=>[d(u.RealGrid,{gridTitle:u.gridProgramTitle,gridConfig:u.gridProgramConfig,onGridInit:u.gridProgramInit,onGridCellClicked:u.gridProgramCellClicked},null,8,["gridTitle","gridConfig"])]),rightSlot:i(()=>[l("div",E,[d(u.SearchContainer,null,{colgroup:i(()=>a[4]||(a[4]=[l("col",{width:"100"},null,-1),l("col",{width:"300"},null,-1),l("col",{width:"*"},null,-1)])),default:i(()=>[l("tbody",null,[l("tr",null,[l("th",null,n(u.t(`${u.programId}.search.btnGrpId.title`)),1),l("td",null,[d(u.ElementSelect,{modelValue:u.btnGrpCd,"onUpdate:modelValue":a[1]||(a[1]=e=>u.btnGrpCd=e),defaultOptions:{label:u.t("common.title.choice"),value:""},options:u.comCodes.btnGrpCd,onChange:u.groupChange},null,8,["modelValue","defaultOptions","options"])]),a[5]||(a[5]=l("td",null,null,-1))])])]),_:1}),u.isGridAuthReady?(b(),t(u.RealGrid,{key:0,gridTitle:`${u.gridAuthTitle}${Object.keys(u.selectedRowInfo).length>0&&u.btnGrpCd.length>0?`: ${u.selectedRowInfo.programNm}`:""}`,gridConfig:u.gridAuthConfig,isEditable:Object.keys(u.selectedRowInfo).length>0&&u.btnGrpCd.length>0,onGridInit:u.gridAuthInit,onGridSaveClick:u.gridAuthSaveClick},null,8,["gridTitle","gridConfig","isEditable"])):r("",!0)])]),_:1})]),_:1})):r("",!0)}],["__file","/Users/kokimin/WorkSpace/vue_design_system/src/views/ProgramAuthMgmt/ProgramAuthMgmt.vue"]]);export{M as default};
